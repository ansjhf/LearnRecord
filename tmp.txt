import com.alibaba.excel.EasyExcel;
import com.alibaba.excel.read.listener.ReadListener;
import com.alibaba.excel.read.metadata.ReadSheet;
import com.alibaba.excel.read.metadata.CellData;
import org.springframework.web.multipart.MultipartFile;
import java.io.IOException;
import java.io.InputStream;
import java.util.ArrayList;
import java.util.Collections;
import java.util.List;

public class ExcelReader {

    public List<String> getFirstRow(MultipartFile file) {
        FirstRowListener listener = new FirstRowListener();
        try (InputStream is = file.getInputStream()) {
            EasyExcel.read(is, List.class, listener).sheet().doRead();
        } catch (IOException e) {
            throw new RuntimeException("读取Excel文件失败", e);
        }
        return listener.getFirstRow();
    }

    private static class FirstRowListener implements ReadListener<List<CellData>> {
        private List<String> firstRow;
        private boolean isDone = false;

        @Override
        public void invoke(List<CellData> data, AnalysisContext context) {
            if (!isDone) {
                firstRow = new ArrayList<>();
                for (CellData cell : data) {
                    firstRow.add(cell.getStringValue());
                }
                isDone = true; // 标记已读取第一行
            }
            // 后续行直接跳过处理
        }

        @Override
        public void doAfterAllAnalysed(AnalysisContext context) {}

        public List<String> getFirstRow() {
            return firstRow == null ? Collections.emptyList() : firstRow;
        }
    }
}